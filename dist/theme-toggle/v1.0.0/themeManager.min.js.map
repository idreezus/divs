{"version":3,"file":"themeManager.min.js","sources":["../../../packages/theme-toggle/src/config.js","../../../packages/theme-toggle/src/themeManager.js"],"sourcesContent":["// Data attribute names\nexport const ATTRIBUTES = {\n  THEME: 'data-theme',\n  THEME_SYSTEM: 'data-theme-system',\n  TOGGLE: 'data-theme-toggle',\n  VALUE: 'data-theme-value',\n  ACTIVE: 'data-theme-active',\n};\n\n// Default configuration values\nexport const DEFAULTS = {\n  THEMES: ['light', 'dark'],\n  FALLBACK_THEME: 'light',\n};\n\n// localStorage configuration\nexport const STORAGE = {\n  KEY: 'theme',\n};\n\nexport const CONFIG = {\n  ATTRIBUTES,\n  DEFAULTS,\n  STORAGE,\n};\n","// Theme Manager - Declarative theme toggle with state management\n// Core script handles state/logic only - developers control styling via CSS\n\nimport { CONFIG } from './config.js';\n\n(() => {\n  'use strict';\n\n  const ThemeManager = {\n    // Available themes - extend this array for multi-theme support\n    themes: CONFIG.DEFAULTS.THEMES.slice(),\n\n    // Current effective theme (never \"system\")\n    current: null,\n\n    // Theme source: \"user\" or \"system\"\n    source: null,\n\n    // Initialization state\n    initialized: false,\n\n    // Internal storage for cleanup\n    _toggles: [],\n    _toggleListeners: new WeakMap(),\n    _mediaQuery: null,\n    _mediaQueryListener: null,\n\n    // Returns the effective theme (resolves 'system' to actual light/dark)\n    getEffectiveTheme(theme) {\n      if (theme === 'system') {\n        return window.matchMedia('(prefers-color-scheme: dark)').matches\n          ? 'dark'\n          : 'light';\n      }\n      return theme;\n    },\n\n    // Sets the active theme with validation\n    setTheme(theme, options = {}) {\n      const { force = false } = options;\n\n      // Determine if this is system mode\n      const isSystemMode = theme === 'system';\n      const newSource = isSystemMode ? 'system' : 'user';\n\n      // Calculate effective theme\n      const newEffective = isSystemMode\n        ? this.getEffectiveTheme('system')\n        : theme;\n\n      // Validate effective theme exists (skip validation for system mode)\n      if (!isSystemMode && this.themes.indexOf(theme) === -1) {\n        console.warn(\n          `[ThemeManager] Theme \"${theme}\" not in themes array:`,\n          this.themes\n        );\n        return this;\n      }\n\n      // Skip if no change (unless forced)\n      if (!force && newEffective === this.current && newSource === this.source) {\n        return this;\n      }\n\n      const previousEffective = this.current;\n      const previousSource = this.source;\n\n      this.current = newEffective;\n      this.source = newSource;\n\n      // Update CSS class on <body> (remove old, add new)\n      if (previousEffective) {\n        document.body.classList.remove(previousEffective);\n      }\n      document.body.classList.add(newEffective);\n\n      // Set data-theme attribute on <html> (always effective theme)\n      document.documentElement.setAttribute(CONFIG.ATTRIBUTES.THEME, newEffective);\n\n      // Handle data-theme-system (boolean attribute)\n      if (isSystemMode) {\n        document.documentElement.setAttribute(CONFIG.ATTRIBUTES.THEME_SYSTEM, '');\n      } else {\n        document.documentElement.removeAttribute(CONFIG.ATTRIBUTES.THEME_SYSTEM);\n      }\n\n      // Save to localStorage (with try/catch for private browsing)\n      try {\n        localStorage.setItem(CONFIG.STORAGE.KEY, isSystemMode ? 'system' : newEffective);\n      } catch (e) {\n        console.warn('[ThemeManager] localStorage unavailable');\n      }\n\n      // Update all toggle buttons\n      this.updateThemeButtons();\n\n      // Dispatch event if there was any change\n      const effectiveChanged = previousEffective !== newEffective;\n      if (effectiveChanged || previousSource !== newSource || force) {\n        window.dispatchEvent(\n          new CustomEvent('themechange', {\n            detail: {\n              theme: newEffective,\n              previous: previousEffective,\n              source: newSource,\n              previousSource,\n              effectiveChanged,\n            },\n          })\n        );\n      }\n\n      return this;\n    },\n\n    // Returns the current effective theme\n    getTheme() {\n      return this.current;\n    },\n\n    // Returns the current source (\"user\" or \"system\")\n    getSource() {\n      return this.source;\n    },\n\n    // Cycles to the next theme (skips \"system\")\n    toggleTheme() {\n      // Filter out \"system\" from cycle\n      const cyclableThemes = this.themes.filter((t) => t !== 'system');\n\n      const currentIndex = cyclableThemes.indexOf(this.current);\n      const nextIndex =\n        currentIndex === -1 ? 0 : (currentIndex + 1) % cyclableThemes.length;\n\n      return this.setTheme(cyclableThemes[nextIndex]);\n    },\n\n    // Updates all toggle and value button states\n    updateThemeButtons() {\n      // Handle data-theme-value buttons\n      document\n        .querySelectorAll(`[${CONFIG.ATTRIBUTES.VALUE}]`)\n        .forEach((btn) => {\n          const btnTheme = btn.getAttribute(CONFIG.ATTRIBUTES.VALUE);\n\n          let isActive = false;\n          if (btnTheme === 'system') {\n            // System button is active when source is system\n            isActive = this.source === 'system';\n          } else {\n            // Theme button is active when it matches current effective theme\n            isActive = btnTheme === this.current;\n          }\n\n          // Boolean attribute (present/absent)\n          if (isActive) {\n            btn.setAttribute(CONFIG.ATTRIBUTES.ACTIVE, '');\n          } else {\n            btn.removeAttribute(CONFIG.ATTRIBUTES.ACTIVE);\n          }\n\n          // Accessibility\n          btn.setAttribute('aria-pressed', isActive ? 'true' : 'false');\n          if (!btn.hasAttribute('aria-label')) {\n            btn.setAttribute('aria-label', `${btnTheme} theme`);\n          }\n        });\n\n      // Handle data-theme-toggle buttons (never active)\n      document\n        .querySelectorAll(`[${CONFIG.ATTRIBUTES.TOGGLE}]`)\n        .forEach((btn) => {\n          btn.removeAttribute(CONFIG.ATTRIBUTES.ACTIVE);\n          if (!btn.hasAttribute('aria-label')) {\n            btn.setAttribute('aria-label', 'Toggle theme');\n          }\n        });\n\n      return this;\n    },\n\n    // Sets up toggle and value button click listeners\n    _setupToggles() {\n      // Setup data-theme-toggle (cycle)\n      document\n        .querySelectorAll(`[${CONFIG.ATTRIBUTES.TOGGLE}]`)\n        .forEach((btn) => {\n          const listener = () => this.toggleTheme();\n          btn.addEventListener('click', listener);\n          this._toggles.push(btn);\n          this._toggleListeners.set(btn, listener);\n        });\n\n      // Setup data-theme-value (explicit)\n      document\n        .querySelectorAll(`[${CONFIG.ATTRIBUTES.VALUE}]`)\n        .forEach((btn) => {\n          const theme = btn.getAttribute(CONFIG.ATTRIBUTES.VALUE);\n          const listener = () => this.setTheme(theme);\n          btn.addEventListener('click', listener);\n          this._toggles.push(btn);\n          this._toggleListeners.set(btn, listener);\n        });\n    },\n\n    // Removes toggle button click listeners\n    _teardownToggles() {\n      this._toggles.forEach((toggle) => {\n        const listener = this._toggleListeners.get(toggle);\n        if (listener) {\n          toggle.removeEventListener('click', listener);\n          this._toggleListeners.delete(toggle);\n        }\n      });\n      this._toggles = [];\n    },\n\n    // Initializes ThemeManager and attaches event listeners\n    init() {\n      if (this.initialized) {\n        console.warn('[ThemeManager] Already initialized. Call destroy() first.');\n        return this;\n      }\n\n      try {\n        // Read initial theme from localStorage\n        let stored = null;\n        try {\n          stored = localStorage.getItem(CONFIG.STORAGE.KEY);\n        } catch (e) {\n          // localStorage unavailable\n        }\n\n        // First visit or explicit \"system\" = system mode\n        const isSystemMode = !stored || stored === 'system';\n\n        if (isSystemMode) {\n          this.source = 'system';\n          this.current = this.getEffectiveTheme('system');\n        } else if (this.themes.indexOf(stored) !== -1) {\n          this.source = 'user';\n          this.current = stored;\n        } else {\n          // Invalid stored theme - fallback to system mode\n          this.source = 'system';\n          this.current = this.getEffectiveTheme('system');\n        }\n\n        // Ensure DOM matches (in case headCode didn't run)\n        // Use force: true to ensure initial setup completes\n        this.setTheme(isSystemMode ? 'system' : this.current, { force: true });\n\n        // Setup toggle button click listeners\n        this._setupToggles();\n\n        // Setup system preference sync\n        this._setupSystemSync();\n\n        this.initialized = true;\n      } catch (e) {\n        console.error('[ThemeManager] Initialization failed:', e);\n      }\n\n      return this;\n    },\n\n    // Sets up system preference change listener\n    _setupSystemSync() {\n      this._mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');\n\n      this._mediaQueryListener = (e) => {\n        // Only react if source is system\n        if (this.source === 'system') {\n          const newEffective = e.matches ? 'dark' : 'light';\n          const previousEffective = this.current;\n\n          this.current = newEffective;\n\n          // Update DOM\n          document.body.classList.remove(previousEffective);\n          document.body.classList.add(newEffective);\n          document.documentElement.setAttribute(\n            CONFIG.ATTRIBUTES.THEME,\n            newEffective\n          );\n\n          // Update button states\n          this.updateThemeButtons();\n\n          // Dispatch event for developer animations\n          window.dispatchEvent(\n            new CustomEvent('themechange', {\n              detail: {\n                theme: newEffective,\n                previous: previousEffective,\n                source: 'system',\n                previousSource: 'system',\n                effectiveChanged: true,\n              },\n            })\n          );\n        }\n      };\n\n      this._mediaQuery.addEventListener('change', this._mediaQueryListener);\n    },\n\n    // Removes system preference change listener\n    _teardownSystemSync() {\n      if (this._mediaQuery && this._mediaQueryListener) {\n        this._mediaQuery.removeEventListener('change', this._mediaQueryListener);\n        this._mediaQuery = null;\n        this._mediaQueryListener = null;\n      }\n    },\n\n    // Re-scan DOM for toggle buttons (useful for SPAs)\n    refresh() {\n      if (!this.initialized) {\n        console.warn('[ThemeManager] Not initialized. Call init() first.');\n        return this;\n      }\n\n      // Remove existing listeners\n      this._teardownToggles();\n\n      // Re-setup toggles\n      this._setupToggles();\n\n      // Update button states\n      this.updateThemeButtons();\n\n      return this;\n    },\n\n    // Cleans up event listeners and resets state\n    destroy() {\n      if (!this.initialized) {\n        return this;\n      }\n\n      // Remove toggle listeners\n      this._teardownToggles();\n\n      // Remove system sync listener\n      this._teardownSystemSync();\n\n      // Reset state\n      this.current = null;\n      this.source = null;\n      this.initialized = false;\n\n      return this;\n    },\n  };\n\n  // Auto-initialize on DOMContentLoaded\n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', () => {\n      ThemeManager.init();\n    });\n  } else {\n    ThemeManager.init();\n  }\n\n  // Expose to window\n  if (typeof window !== 'undefined') {\n    window.ThemeManager = ThemeManager;\n  }\n})();\n"],"names":["CONFIG","ATTRIBUTES","THEME","THEME_SYSTEM","TOGGLE","VALUE","ACTIVE","DEFAULTS","THEMES","FALLBACK_THEME","STORAGE","KEY","ThemeManager","themes","slice","current","source","initialized","_toggles","_toggleListeners","WeakMap","_mediaQuery","_mediaQueryListener","getEffectiveTheme","theme","window","matchMedia","matches","setTheme","options","force","isSystemMode","newSource","newEffective","this","indexOf","console","warn","previousEffective","previousSource","document","body","classList","remove","add","documentElement","setAttribute","removeAttribute","localStorage","setItem","e","updateThemeButtons","effectiveChanged","dispatchEvent","CustomEvent","detail","previous","getTheme","getSource","toggleTheme","cyclableThemes","filter","t","currentIndex","nextIndex","length","querySelectorAll","forEach","btn","btnTheme","getAttribute","isActive","hasAttribute","_setupToggles","listener","addEventListener","push","set","_teardownToggles","toggle","get","removeEventListener","delete","init","stored","getItem","_setupSystemSync","error","_teardownSystemSync","refresh","destroy","readyState"],"mappings":"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"}