/*!
 * Theme Toggle v1.0.0
 * A vanilla JavaScript theme switcher for light, dark, and custom themes.
 *
 * A part of Divs by Idreezus, a component library
 * divs.idreezus.com
 *
 * (c) 2025 Idrees Isse (https://github.com/idreezus)
 * Released under AGPL-3.0
 */
!function(){"use strict";const e={ATTRIBUTES:{THEME:"data-theme",THEME_SYSTEM:"data-theme-system",TOGGLE:"data-theme-toggle",VALUE:"data-theme-value",ACTIVE:"data-theme-active"},DEFAULTS:{THEMES:["light","dark"],FALLBACK_THEME:"light"},STORAGE:{KEY:"theme"}};(()=>{const t={themes:e.DEFAULTS.THEMES.slice(),current:null,source:null,initialized:!1,_toggles:[],_toggleListeners:new WeakMap,_mediaQuery:null,_mediaQueryListener:null,getEffectiveTheme:e=>"system"===e?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":e,setTheme(t,s={}){const{force:i=!1}=s,r="system"===t,n=r?"system":"user",h=r?this.getEffectiveTheme("system"):t;if(!r&&-1===this.themes.indexOf(t))return console.warn(`[ThemeManager] Theme "${t}" not in themes array:`,this.themes),this;if(!i&&h===this.current&&n===this.source)return this;const o=this.current,a=this.source;this.current=h,this.source=n,o&&document.body.classList.remove(o),document.body.classList.add(h),document.documentElement.setAttribute(e.ATTRIBUTES.THEME,h),r?document.documentElement.setAttribute(e.ATTRIBUTES.THEME_SYSTEM,""):document.documentElement.removeAttribute(e.ATTRIBUTES.THEME_SYSTEM);try{localStorage.setItem(e.STORAGE.KEY,r?"system":h)}catch(e){console.warn("[ThemeManager] localStorage unavailable")}this.updateThemeButtons();const u=o!==h;return(u||a!==n||i)&&window.dispatchEvent(new CustomEvent("themechange",{detail:{theme:h,previous:o,source:n,previousSource:a,effectiveChanged:u}})),this},getTheme(){return this.current},getSource(){return this.source},toggleTheme(){const e=this.themes.filter(e=>"system"!==e),t=e.indexOf(this.current),s=-1===t?0:(t+1)%e.length;return this.setTheme(e[s])},updateThemeButtons(){return document.querySelectorAll(`[${e.ATTRIBUTES.VALUE}]`).forEach(t=>{const s=t.getAttribute(e.ATTRIBUTES.VALUE);let i=!1;i="system"===s?"system"===this.source:s===this.current,i?t.setAttribute(e.ATTRIBUTES.ACTIVE,""):t.removeAttribute(e.ATTRIBUTES.ACTIVE),t.setAttribute("aria-pressed",i?"true":"false"),t.hasAttribute("aria-label")||t.setAttribute("aria-label",`${s} theme`)}),document.querySelectorAll(`[${e.ATTRIBUTES.TOGGLE}]`).forEach(t=>{t.removeAttribute(e.ATTRIBUTES.ACTIVE),t.hasAttribute("aria-label")||t.setAttribute("aria-label","Toggle theme")}),this},_setupToggles(){document.querySelectorAll(`[${e.ATTRIBUTES.TOGGLE}]`).forEach(e=>{const t=()=>this.toggleTheme();e.addEventListener("click",t),this._toggles.push(e),this._toggleListeners.set(e,t)}),document.querySelectorAll(`[${e.ATTRIBUTES.VALUE}]`).forEach(t=>{const s=t.getAttribute(e.ATTRIBUTES.VALUE),i=()=>this.setTheme(s);t.addEventListener("click",i),this._toggles.push(t),this._toggleListeners.set(t,i)})},_teardownToggles(){this._toggles.forEach(e=>{const t=this._toggleListeners.get(e);t&&(e.removeEventListener("click",t),this._toggleListeners.delete(e))}),this._toggles=[]},init(){if(this.initialized)return console.warn("[ThemeManager] Already initialized. Call destroy() first."),this;try{let t=null;try{t=localStorage.getItem(e.STORAGE.KEY)}catch(e){}const s=!t||"system"===t;s?(this.source="system",this.current=this.getEffectiveTheme("system")):-1!==this.themes.indexOf(t)?(this.source="user",this.current=t):(this.source="system",this.current=this.getEffectiveTheme("system")),this.setTheme(s?"system":this.current,{force:!0}),this._setupToggles(),this._setupSystemSync(),this.initialized=!0}catch(e){console.error("[ThemeManager] Initialization failed:",e)}return this},_setupSystemSync(){this._mediaQuery=window.matchMedia("(prefers-color-scheme: dark)"),this._mediaQueryListener=t=>{if("system"===this.source){const s=t.matches?"dark":"light",i=this.current;this.current=s,document.body.classList.remove(i),document.body.classList.add(s),document.documentElement.setAttribute(e.ATTRIBUTES.THEME,s),this.updateThemeButtons(),window.dispatchEvent(new CustomEvent("themechange",{detail:{theme:s,previous:i,source:"system",previousSource:"system",effectiveChanged:!0}}))}},this._mediaQuery.addEventListener("change",this._mediaQueryListener)},_teardownSystemSync(){this._mediaQuery&&this._mediaQueryListener&&(this._mediaQuery.removeEventListener("change",this._mediaQueryListener),this._mediaQuery=null,this._mediaQueryListener=null)},refresh(){return this.initialized?(this._teardownToggles(),this._setupToggles(),this.updateThemeButtons(),this):(console.warn("[ThemeManager] Not initialized. Call init() first."),this)},destroy(){return this.initialized?(this._teardownToggles(),this._teardownSystemSync(),this.current=null,this.source=null,this.initialized=!1,this):this}};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{t.init()}):t.init(),"undefined"!=typeof window&&(window.ThemeManager=t)})()}();
//# sourceMappingURL=themeManager.min.js.map
