/*!
 * Theme Toggle v1.0.0
 * A vanilla JavaScript theme switcher for light, dark, and custom themes.
 *
 * A part of Divs by Idreezus, a component library
 * divs.idreezus.com
 *
 * (c) 2025 Idrees Isse (https://github.com/idreezus)
 * Released under AGPL-3.0
 */
!function(){"use strict";(()=>{const e="data-theme",t="data-theme-value",s="theme",i={themes:["light","dark"].slice(),current:null,theme:null,initialized:!1,_toggles:[],_toggleListeners:new WeakMap,_mediaQuery:null,_mediaQueryListener:null,getEffectiveTheme:e=>"system"===e?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":e,setTheme(t,i={}){const{force:n=!1}=i,r="system"===t,h=r?this.getEffectiveTheme("system"):t;if(!r&&-1===this.themes.indexOf(t))return console.warn(`[ThemeManager] Theme "${t}" not in themes array:`,this.themes),this;if(!n&&h===this.current&&t===this.theme)return this;const a=this.current,o=this.theme;this.current=h,this.theme=t,a&&(document.documentElement.classList.remove(a),document.body.classList.remove(a)),document.documentElement.classList.add(h),document.body.classList.add(h),document.documentElement.setAttribute(e,t),document.body.setAttribute(e,t);try{localStorage.setItem(s,t)}catch(e){console.warn("[ThemeManager] localStorage unavailable")}const m=a!==h;return(m||o!==t||n)&&window.dispatchEvent(new CustomEvent("themechange",{detail:{theme:h,previous:a,userTheme:t,previousUserTheme:o,effectiveChanged:m}})),this},getTheme(){return this.current},getUserTheme(){return this.theme},getSource(){return"system"===this.theme?"system":"user"},toggleTheme(){const e=this.themes.filter(e=>"system"!==e),t=e.indexOf(this.current),s=-1===t?0:(t+1)%e.length;return this.setTheme(e[s])},_addA11yAttributes(e,t){e.hasAttribute("aria-label")||e.setAttribute("aria-label",t),e.hasAttribute("title")||e.setAttribute("title",t)},_setupToggles(){document.querySelectorAll("[data-theme-toggle]").forEach(e=>{this._addA11yAttributes(e,"Switch color theme");const t=()=>this.toggleTheme();e.addEventListener("click",t),this._toggles.push(e),this._toggleListeners.set(e,t)}),document.querySelectorAll(`[${t}]`).forEach(e=>{const s=e.getAttribute(t);this._addA11yAttributes(e,`Switch to ${s} color theme`);const i=()=>this.setTheme(s);e.addEventListener("click",i),this._toggles.push(e),this._toggleListeners.set(e,i)})},_teardownToggles(){this._toggles.forEach(e=>{const t=this._toggleListeners.get(e);t&&(e.removeEventListener("click",t),this._toggleListeners.delete(e))}),this._toggles=[]},init(){if(this.initialized)return console.warn("[ThemeManager] Already initialized. Call destroy() first."),this;try{let e=null;try{e=localStorage.getItem(s)}catch(e){}const t=e||"system";"system"!==t&&-1===this.themes.indexOf(t)?this.theme="system":this.theme=t,this.current=this.getEffectiveTheme(this.theme),this.setTheme(this.theme,{force:!0}),this._setupToggles(),this._setupSystemSync(),this.initialized=!0}catch(e){console.error("[ThemeManager] Initialization failed:",e)}return this},_setupSystemSync(){this._mediaQuery=window.matchMedia("(prefers-color-scheme: dark)"),this._mediaQueryListener=e=>{if("system"===this.theme){const t=e.matches?"dark":"light",s=this.current;this.current=t,document.documentElement.classList.remove(s),document.documentElement.classList.add(t),document.body.classList.remove(s),document.body.classList.add(t),window.dispatchEvent(new CustomEvent("themechange",{detail:{theme:t,previous:s,userTheme:"system",previousUserTheme:"system",effectiveChanged:!0}}))}},this._mediaQuery.addEventListener("change",this._mediaQueryListener)},_teardownSystemSync(){this._mediaQuery&&this._mediaQueryListener&&(this._mediaQuery.removeEventListener("change",this._mediaQueryListener),this._mediaQuery=null,this._mediaQueryListener=null)},refresh(){return this.initialized?(this._teardownToggles(),this._setupToggles(),this):(console.warn("[ThemeManager] Not initialized. Call init() first."),this)},destroy(){return this.initialized?(this._teardownToggles(),this._teardownSystemSync(),this.current=null,this.theme=null,this.initialized=!1,this):this}};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{i.init()}):i.init(),"undefined"!=typeof window&&(window.ThemeManager=i)})()}();
//# sourceMappingURL=theme-toggle.min.js.map
