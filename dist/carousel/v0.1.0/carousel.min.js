/*!
 * Carousel v0.1.0
 * A lightweight, accessible carousel component built on CSS scroll snap
 * 
 * A part of Divs by Idreezus, a component library
 * divs.idreezus.com
 * 
 * (c) 2025 Idrees Isse (https://github.com/idreezus)
 * Released under AGPL-3.0
 */
!function(){"use strict";const e={CONTAINER:'[data-carousel="container"]',TRACK:'[data-carousel="track"]',ITEM:'[data-carousel="item"]',PREV_BTN:'[data-carousel="prev"]',NEXT_BTN:'[data-carousel="next"]',PAGINATION:'[data-carousel="pagination"]',DOT:'[data-carousel="dot"]'},t="start",n="item",s={SELECTORS:e,CLASSES:{SCROLLING:"carousel-scrolling",DISABLED:"carousel-button-disabled",ACTIVE:"carousel-item-active",ANIMATING:"carousel-animating",SNAP_DISABLED:"carousel-snap-disabled",PAGINATION_ACTIVE:"carousel-pagination-active"},TIMING:{DEBOUNCE_RESIZE:150,DEBOUNCE_SCROLL:100,BUTTON_COOLDOWN:100,SNAP_DISABLE_DURATION:50},TOLERANCE:{EDGE_DETECTION:1}};let r=0;function o(e,t){let n;return function(...s){clearTimeout(n),n=setTimeout(()=>{clearTimeout(n),e(...s)},t)}}function i(e,t,n={}){const{events:s,container:r}=e;if(s.has(t)){s.get(t).forEach(s=>{s.call(e,{type:t,target:e,...n})})}const o=new CustomEvent(`carousel:${t}`,{detail:{carousel:e,...n},bubbles:!0});r.dispatchEvent(o)}function a(e){const{track:t,items:n,state:s,config:r}=e,o=getComputedStyle(t),i=e=>{if(!e||"auto"===e)return{value:0,specified:!1};const t=parseFloat(e);return Number.isNaN(t)?{value:0,specified:!1}:{value:t,specified:!0}},a=parseFloat(o.gap||o.columnGap)||0,l=i(o.paddingInlineStart||o.paddingLeft),c=i(o.paddingInlineEnd||o.paddingRight),d=i(o.scrollPaddingInlineStart||o.scrollPaddingLeft),u=i(o.scrollPaddingInlineEnd||o.scrollPaddingRight),g=d.specified?d.value:l.value,E=u.specified?u.value:c.value,h=t.clientWidth,f=t.scrollWidth,I=t.getBoundingClientRect(),m=n.map((e,n)=>{const s=e.getBoundingClientRect(),r=getComputedStyle(e),o=parseFloat(r.scrollMarginInlineStart||r.scrollMarginLeft),i=parseFloat(r.scrollMarginInlineEnd||r.scrollMarginRight),a=Number.isNaN(o)?0:o,l=Number.isNaN(i)?0:i,c=s.left-I.left+t.scrollLeft,d=s.width;return{index:n,left:c,width:d,center:c+d/2,right:c+d,marginStart:a,marginEnd:l}});Object.assign(s,{gap:a,containerWidth:h,scrollWidth:f,itemPositions:m,startInset:g,endInset:E}),e.snapAlign=r.align,console.log("[DEBUG calculateDimensions] Dimensions calculated:",{gap:a,containerWidth:h,scrollWidth:f,snapAlign:e.snapAlign,startInset:g,endInset:E,itemCount:m.length})}function l(e){const{track:t,state:n,snapAlign:s}=e,{itemPositions:r,currentIndex:o,startInset:a=0,endInset:l=0}=n,c=t.scrollLeft,d=function(e,t,n,s,r={}){const{startInset:o=0,endInset:i=0}=r,a=function(e,t,n,s={}){const{startInset:r=0,endInset:o=0}=s;switch(n){case"center":return e+t/2+(r-o)/2;case"end":return e+t-o;default:return e+r}}(t,n,s,{startInset:o,endInset:i});let l=0,c=1/0;const d=[];return e.forEach((e,t)=>{const n=function(e,t){const n=e.marginStart||0,s=e.marginEnd||0;switch(t){case"center":return e.center+(s-n)/2;case"end":return e.right+s;default:return e.left-n}}(e,s),r=Math.abs(n-a);d.push({index:t,itemPoint:n,distance:r}),r<c&&(c=r,l=t)}),console.log("[DEBUG findActiveIndex]",{scrollLeft:t,containerWidth:n,snapAlign:s,referencePoint:a,startInset:o,endInset:i,distances:d,closestIndex:l,minDistance:c}),l}(r,c,n.containerWidth,s,{startInset:a,endInset:l});console.log("[DEBUG detectActiveItem]",{scrollLeft:c,currentIndex:o,activeIndex:d,changed:d!==o,startInset:a,endInset:l,itemPositions:r.map((e,t)=>({index:t,left:e.left,width:e.width}))}),d!==o&&(n.currentIndex=d,f(e),i(e,"change",{index:d}))}function c(e){const{track:t,prevBtn:n,nextBtn:r,state:o}=e,{CLASSES:a,TOLERANCE:l}=s,c=t.scrollLeft,{scrollWidth:d,containerWidth:u}=o,g=d-u,E=c<=l.EDGE_DETECTION,h=c>=g-l.EDGE_DETECTION;console.log("[DEBUG updateButtonStates]",{scrollLeft:c,maxScroll:g,atStart:E,atEnd:h,currentIndex:o.currentIndex}),n&&(n.classList.toggle(a.DISABLED,E),n.disabled=E,E&&!o.hasEmittedStart?(i(e,"reach-start"),o.hasEmittedStart=!0):E||(o.hasEmittedStart=!1)),r&&(r.classList.toggle(a.DISABLED,h),r.disabled=h,h&&!o.hasEmittedEnd?(i(e,"reach-end"),o.hasEmittedEnd=!0):h||(o.hasEmittedEnd=!1))}function d(e,t){const{track:n,items:r,state:o,snapAlign:i}=e,{CLASSES:a,TIMING:l}=s;console.log("[DEBUG scrollToItem] called with index:",t);const c=r[t];c?(o.isAnimating=!0,n.classList.add(a.ANIMATING),n.classList.add(a.SNAP_DISABLED),console.log("[DEBUG scrollToItem]",{index:t,snapAlign:i,currentScrollLeft:n.scrollLeft}),c.scrollIntoView({behavior:"smooth",block:"nearest",inline:i}),setTimeout(()=>{n.classList.remove(a.SNAP_DISABLED)},l.SNAP_DISABLE_DURATION),setTimeout(()=>{o.isAnimating=!1,n.classList.remove(a.ANIMATING)},l.BUTTON_COOLDOWN)):console.warn(`Carousel ${e.id}: No item found at index ${t}`)}function u(e){const{state:t}=e;if(console.log("[DEBUG handleNext] called",{isAnimating:t.isAnimating,currentIndex:t.currentIndex}),t.isAnimating)return;const n=function(e){const{state:t,items:n}=e,{currentIndex:s}=t,r=Math.min(s+1,n.length-1);return console.log("[DEBUG calculateNextIndex]",{currentIndex:s,nextIndex:r,itemsLength:n.length}),r}(e);console.log("[DEBUG handleNext] scrolling to:",n),d(e,n)}function g(e){const{state:t,prevBtn:n}=e;if(console.log("[DEBUG handlePrev] called",{isAnimating:t.isAnimating,currentIndex:t.currentIndex,buttonDisabled:n?n.disabled:"no button"}),t.isAnimating)return;const s=function(e){const{state:t}=e,{currentIndex:n}=t,s=Math.max(n-1,0);return console.log("[DEBUG calculatePrevIndex]",{currentIndex:n,prevIndex:s}),s}(e);console.log("[DEBUG handlePrev] scrolling to:",s),d(e,s)}function E(e){const{pagination:t,items:n,id:r}=e;if(!t)return;e.boundDotHandlers&&e.boundDotHandlers.forEach(({dot:e,handler:t})=>{e.removeEventListener("click",t)});const o=function(e){return Array.isArray(e)?e.length:0}(n),i=e.dots?[...e.dots]:[];if(0===i.length)return void console.warn(`Carousel ${r}: At least one pagination dot is required inside the pagination container.`);const a=[];e.boundDotHandlers=[];const l=i.map(e=>(e=>{if(e.tagName&&"button"===e.tagName.toLowerCase())return e;const t=document.createElement("button");for([...e.attributes].forEach(e=>{t.setAttribute(e.name,e.value)});e.firstChild;)t.appendChild(e.firstChild);return e.replaceWith(t),t})(e)),c=l.length;for(;l.length<o;){const e=l[l.length%c].cloneNode(!0);t.appendChild(e),l.push(e)}if(l.length>o){l.splice(o).forEach(e=>{e.remove()})}l.forEach((t,n)=>{((t,n)=>{const{CLASSES:r}=s;t.setAttribute("data-carousel","dot"),t.setAttribute("type","button"),t.classList.remove(r.PAGINATION_ACTIVE);const o=()=>e.goTo(n);t.addEventListener("click",o),e.boundDotHandlers.push({dot:t,handler:o}),a.push(t)})(t,n)}),e.dots=a,h(e)}function h(e){const{dots:t,state:n}=e,{CLASSES:r}=s,{currentIndex:o}=n;t&&0!==t.length&&t.forEach((e,t)=>{const n=t===o;e.classList.toggle(r.PAGINATION_ACTIVE,n)})}function f(e){const{rafPending:t}=e;t||(e.rafPending=!0,requestAnimationFrame(()=>{!function(e){const{items:t,state:n}=e,{CLASSES:r}=s,{currentIndex:o}=n;t.forEach((e,t)=>{e.classList.toggle(r.ACTIVE,t===o)})}(e),c(e),h(e),e.rafPending=!1}))}function I(e){const{track:t,prevBtn:n,nextBtn:r,id:a}=e;e.boundHandlers={scroll:()=>function(e){const{track:t}=e,{CLASSES:n,TIMING:r}=s;t.classList.add(n.SCROLLING),i(e,"scroll",{scrollLeft:t.scrollLeft}),e.debouncedScrollHandler||(e.debouncedScrollHandler=o(()=>{l(e),c(e),t.classList.remove(n.SCROLLING)},r.DEBOUNCE_SCROLL)),e.debouncedScrollHandler()}(e),prev:()=>g(e),next:()=>u(e)},t.addEventListener("scroll",e.boundHandlers.scroll,{passive:!0}),n&&n.addEventListener("click",e.boundHandlers.prev),r&&r.addEventListener("click",e.boundHandlers.next)}function m(e){const t=function(e){const{container:t,id:n}=e,{SELECTORS:r}=s,o=t.querySelector(r.TRACK);if(!o)return console.warn(`Carousel ${n}: Track element not found. Expected element with data-carousel="track".`),!1;const i=[...t.querySelectorAll(r.ITEM)];if(console.log("[DEBUG findElements] Items found:",{count:i.length,items:i.map((e,t)=>({index:t,textContent:e.textContent?.substring(0,30),classList:Array.from(e.classList)}))}),0===i.length)return console.warn(`Carousel ${n}: No items found. Expected at least one element with data-carousel="item".`),!1;const a=t.querySelector(r.PREV_BTN),l=t.querySelector(r.NEXT_BTN),c=t.querySelector(r.PAGINATION);let d=[];return c&&(d=[...c.querySelectorAll(r.DOT)]),t.setAttribute("data-carousel-id",n),Object.assign(e,{track:o,items:i,prevBtn:a,nextBtn:l,pagination:c,dots:d}),!0}(e);return!!t&&(a(e),I(e),function(e){const{container:t,track:n}=e,{TIMING:r}=s,i=o(()=>{null!==t.offsetParent&&(a(e),l(e),c(e))},r.DEBOUNCE_RESIZE);e.debouncedResizeHandler=i;const d=new ResizeObserver(()=>{i()});d.observe(t),d.observe(n),e.resizeObserver=d}(e),E(e),e.config.keyboard&&function(e,t,n){const{container:s}=e;s.hasAttribute("tabindex")||s.setAttribute("tabindex","0");const r=r=>{if(s.contains(r.target))switch(r.key){case"ArrowLeft":r.preventDefault(),t(e);break;case"ArrowRight":r.preventDefault(),n(e);break;case"Home":r.preventDefault(),e.goTo(0);break;case"End":r.preventDefault(),e.goTo(e.items.length-1)}};e.boundHandlers.keyboard=r,s.addEventListener("keydown",r)}(e,g,u),f(e),console.log("[DEBUG init] Carousel initialized",{id:e.id,currentIndex:e.state.currentIndex,itemCount:e.items.length,scrollLeft:e.track.scrollLeft}),!0)}class A{constructor(e){const s=(r+=1,`carousel-${r}`),o=function(e){return{align:e.getAttribute("data-carousel-align")||t,keyboard:"true"===e.getAttribute("data-carousel-keyboard"),scrollBy:e.getAttribute("data-carousel-scroll-by")||n,loop:"true"===e.getAttribute("data-carousel-loop")}}(e);Object.assign(this,{container:e,id:s,config:o,state:{currentIndex:0,isScrolling:!1,isAnimating:!1,itemPositions:[],gap:0,containerWidth:0,scrollWidth:0,startInset:0,endInset:0,hasEmittedStart:!1,hasEmittedEnd:!1},events:new Map,rafPending:!1,boundHandlers:null,debouncedScrollHandler:null});m(this)||console.warn(`Carousel ${s}: Initialization failed due to missing required elements.`)}next(){return u(this),this}prev(){return g(this),this}goTo(e){const{items:t}=this;return e<0||e>=t.length?(console.warn(`Carousel ${this.id}: Invalid index ${e}. Must be between 0 and ${t.length-1}.`),this):(d(this,e),this)}getActiveIndex(){return this.state.currentIndex}refresh(){return a(this),l(this),f(this),this}destroy(){return function(e){const{prevBtn:t,nextBtn:n,track:s,container:r}=e;e.boundHandlers&&(s.removeEventListener("scroll",e.boundHandlers.scroll),t&&t.removeEventListener("click",e.boundHandlers.prev),n&&n.removeEventListener("click",e.boundHandlers.next),e.boundHandlers.keyboard&&r.removeEventListener("keydown",e.boundHandlers.keyboard)),e.boundDotHandlers&&e.boundDotHandlers.forEach(({dot:e,handler:t})=>{e.removeEventListener("click",t)}),e.resizeObserver&&(e.resizeObserver.disconnect(),e.resizeObserver=null),Object.keys(e).forEach(t=>{e[t]=null})}(this),null}on(e,t){const{events:n}=this;return n.has(e)||n.set(e,[]),n.get(e).push(t),this}off(e,t){const{events:n}=this;if(!n.has(e))return this;const s=n.get(e),r=s.indexOf(t);return r>-1&&s.splice(r,1),this}static init(e){if("string"==typeof e&&(e=document.querySelector(e)),!e)throw new Error("Carousel.init(): Container element not found");return new A(e)}}const b=new Map;function p(){document.querySelectorAll(e.CONTAINER).forEach(e=>{try{const t=new A(e);t.id&&b.set(t.id,t)}catch(e){console.warn("Carousel auto-initialization failed:",e)}}),b.size>0&&console.log(`Carousel: Initialized ${b.size} instance(s)`)}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",p):p(),"undefined"!=typeof window&&(window.Carousel=A,window.CarouselInstances=b)}();
//# sourceMappingURL=carousel.min.js.map
